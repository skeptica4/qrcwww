task.spawn(function()
 local Players = game:GetService("Players")
 local RunService = game:GetService("RunService")
 local UserInputService = game:GetService("UserInputService")
 local LocalPlayer = Players.LocalPlayer
 local enabled = false
 local attackRange = 100
 local loopDelay = 0.05

 local function getMeleeWeapon()
  local char = LocalPlayer.Character
  if not char then return nil end

  for _, container in {char, LocalPlayer.Backpack} do
   if not container then continue end
   for _, item in ipairs(container:GetChildren()) do
    if item:IsA("Tool") and item:FindFirstChild("VerifyHit") then
     return item
    end
   end
  end
  return nil
 end

 UserInputService.InputBegan:Connect(function(input, gp)
  if not gp and input.KeyCode == Enum.KeyCode.Z then
   enabled = not enabled
  end
 end)

 while true do
  task.wait(loopDelay)
  if not enabled then continue end

  local char = LocalPlayer.Character
  local root = char and char:FindFirstChild("HumanoidRootPart")
  if not root then continue end

  local weapon = getMeleeWeapon()
  if not weapon then continue end

  local closestTarget, minDist = nil, attackRange
  for _, model in ipairs(workspace:GetChildren()) do
   local hum = model:FindFirstChildOfClass("Humanoid")
   local hrp = model:FindFirstChild("HumanoidRootPart")

   if hum and hrp and hum.Health > 0 and model ~= char and not Players:GetPlayerFromCharacter(model) then
    local dist = (root.Position - hrp.Position).Magnitude
    if dist < minDist then
     minDist = dist
     closestTarget = hum
    end
   end
  end

  if closestTarget then
   weapon.VerifyHit:FireServer(closestTarget, tick())
  end
 end
end)
