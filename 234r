-- Mobile-Enabled NPC Teleportation Script
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- Mobile detection
local isMobile = (not UserInputService.KeyboardEnabled)

-- Excluded NPCs
local EXCLUDED_NPCS = {
	Landmine = true, Man = true, Turret = true, Stonehedge = true,
	Sprayer = true, Sentinel = true, Refugee = true, PDC = true,
	MADS = true, Lifeline = true, Hallucinator = true, Governor = true,
	FAST_point = true, Barrier = true, Administrator = true
}

for i = 1, 11 do
	EXCLUDED_NPCS["dead guy " .. i] = true
end

local config = {
	enabled = false,
	throttle = 0.1
}

local lastTeleportTime = 0

local getHRP = function()
	local character = LocalPlayer.Character
	return character and character:FindFirstChild("HumanoidRootPart")
end

local teleportNPCs = function()
	local hrp = getHRP()
	if not hrp then
		return
	end
	
	local playerPos = hrp.Position
	local playerForward = hrp.CFrame.LookVector
	local playerY = hrp.Orientation.Y
	
	local children = workspace:GetChildren()
	for _, npc in ipairs(children) do
		if not npc:IsA("Model") then
			continue
		end
		
		if EXCLUDED_NPCS[npc.Name] then
			continue
		end
		
		if Players:GetPlayerFromCharacter(npc) then
			continue
		end
		
		local humanoid = npc:FindFirstChildOfClass("Humanoid")
		local primaryPart = npc.PrimaryPart or npc:FindFirstChild("HumanoidRootPart")
		
		if not humanoid or not primaryPart or humanoid.Health <= 0 then
			continue
		end
		
		local distance = (npc.Name == "Tank") and 13 or 5.7
		local newCFrame = CFrame.new(playerPos + playerForward * distance)
		local rotatedCFrame = newCFrame * CFrame.Angles(0, playerY, 0)
		
		npc:SetPrimaryPartCFrame(rotatedCFrame)
	end
end

-- Desktop keyboard control
if not isMobile then
	local throttle = 0
	
	RunService.Heartbeat:Connect(function(deltaTime)
		if not config.enabled then
			return
		end
		
		throttle = throttle + deltaTime
		
		if throttle >= config.throttle then
			throttle = 0
			teleportNPCs()
		end
	end)
	
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed or input.KeyCode ~= Enum.KeyCode.F1 then
			return
		end
		
		config.enabled = not config.enabled
		print("NPC Teleportation " .. (config.enabled and "Enabled" or "Disabled"))
	end)
else
	-- Mobile touch controls
	local uiAdapter = require(script.Parent:FindFirstChild("mobile_ui_adapter") or game.ServerStorage)
	
	local playerGui = LocalPlayer:WaitForChild("PlayerGui")
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "NPCTeleportMobile"
	screenGui.ResetOnSpawn = false
	screenGui.Parent = playerGui
	
	-- Toggle button
	local toggleButton = Instance.new("TextButton")
	toggleButton.Name = "ToggleButton"
	toggleButton.Size = UDim2.fromOffset(80, 80)
	toggleButton.Position = UDim2.fromOffset(10, 10)
	toggleButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
	toggleButton.BackgroundTransparency = 0.6
	toggleButton.Text = "TP ON"
	toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	toggleButton.Font = Enum.Font.GothamBold
	toggleButton.TextSize = 12
	toggleButton.BorderSizePixel = 0
	toggleButton.Parent = screenGui
	
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 10)
	corner.Parent = toggleButton
	
	toggleButton.Activated:Connect(function()
		config.enabled = not config.enabled
		toggleButton.Text = config.enabled and "TP ON" or "TP OFF"
		toggleButton.BackgroundColor3 = config.enabled and Color3.fromRGB(76, 175, 80) or Color3.fromRGB(0, 120, 215)
	end)
	
	-- Main loop
	local throttle = 0
	
	RunService.Heartbeat:Connect(function(deltaTime)
		if not config.enabled then
			return
		end
		
		throttle = throttle + deltaTime
		
		if throttle >= config.throttle then
			throttle = 0
			teleportNPCs()
		end
	end)
end

print("NPC Teleportation script loaded" .. (isMobile and " (Mobile)" or ""))
